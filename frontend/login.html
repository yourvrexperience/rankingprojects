<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sign in</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body{
      margin:0;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:#f9fafb;
      color:#111827;
    }

    .card{
      width:100%;
      max-width:380px;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:14px;
      padding:22px;
      box-shadow:0 12px 30px rgba(0,0,0,.08);      
    }

    h1{
      font-size:18px;
      margin:0 0 6px 0;
    }

    p{
      margin:0 0 16px 0;
      font-size:13px;
      color:#6b7280;
    }

    label{
      font-size:12px;
      font-weight:600;
      display:block;
      margin:12px 0 4px;
    }

    input{
      width:92%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #d1d5db;
      font-size:14px;
    }

    input:focus{
      outline:none;
      border-color:#111827;
    }

    button{
      margin-top:16px;
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:0;
      background:#111827;
      color:#fff;
      font-size:14px;
      font-weight:700;
      cursor:pointer;
    }

    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    .msg{
      margin-top:12px;
      font-size:13px;
      min-height:18px;
    }

    .msg.error{ color:#b91c1c; }
    .msg.ok{ color:#065f46; }

    .footer{
      margin-top:14px;
      text-align:center;
      font-size:12px;
    }

    .footer a{
      color:#111827;
      text-decoration:underline;
      text-underline-offset:2px;
    }
    .topbar-github{
      font-size: 12px;
      font-weight: 600;
      color: #374151;
      text-decoration: none;
      opacity: 0.85;
      white-space: nowrap;
    }

    .topbar-github:hover{
      text-decoration: underline;
      opacity: 1;
    }
  </style>
</head>

<body>

  <div class="card">
    <h1 data-i18n="lgn.sign.in"></h1>
    <p data-i18n="lgn.sign.and.manage"></p>

    <form id="loginForm" novalidate>
      <label for="email" data-i18n="lgn.sign.email"></label>
      <input id="email" type="email" required data-i18n="lgn.your.email" data-i18n-attr="placeholder"/>

      <label for="password" data-i18n="lgn.password"></label>
      <input id="password" type="password" required minlength="8" data-i18n="lgn.at.least" data-i18n-attr="placeholder"/>

      <button id="submitBtn" type="submit" data-i18n="lgn.sign.in"></button>
      <div id="msg" class="msg"></div>
    </form>

    <div class="footer">   
      <p data-i18n="lgn.dont.have"></p>   
      <a href="register.html" data-i18n="lgn.create.account"></a>
      <p>
      <p><a
        href="https://github.com/yourvrexperience/rankingprojects"
        target="_blank"
        rel="noopener"
        class="topbar-github"
      >
        ‚≠ê View on GitHub
      </a></p>
    </div>
  </div>

<script type="module">
import { getLanguageManager } from "./js/Utils/LanguageManager.js";
import { UserManager } from "./js/Utils/UserManager.js";

const form = document.getElementById("loginForm");
const msg = document.getElementById("msg");
const btn = document.getElementById("submitBtn");

const langManager = await getLanguageManager({
  basePath: "/i18n",
  lang: localStorage.getItem("app_lang") || "en",
  fallbackLang: "en",
  preload: ["en", "es", "ca"]
});

window.languageManager = langManager;
langManager.applyToDOM();

const userManager = new UserManager({ langManager });

function showMessage(text, type) {
  msg.textContent = text || "";
  msg.className = "msg";
  if (type) msg.classList.add(type); // "ok" | "error"
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  showMessage("");

  btn.disabled = true;

  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const result = await userManager.login({ email, password });

  if (!result.ok) {
    const errorText =
      result.error === "NETWORK_ERROR"
        ? langManager.t("lgn.network.error")
        : result.error;

    showMessage(errorText, "error");
    btn.disabled = false;
    return;
  }

  showMessage(langManager.t("lgn.login.successful.redirect"), "ok");

  setTimeout(() => {
    location.href = "administration.html";
  }, 1200);
});
</script>

</body>
</html>